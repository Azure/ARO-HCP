---
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: arobit-secretprovider
spec:
  provider: azure
  parameters:
    clientID: {{ .Values.forwarder.secretProvider.msiClientId }}
    keyvaultName: "{{.Values.forwarder.secretProvider.keyVault}}"
    objects:  |
      array:
        - |
          objectName: "{{.Values.forwarder.secretProvider.rpSecret}}"
          objectAlias: "gcscert.pem"
          objectType: secret
    tenantId: "{{.Values.forwarder.secretProvider.tenantId}}"
{{- if .Values.forwarder.clusterType | eq "mgmt" }}
---
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: arobit-secretprovider-clusterlogs
spec:
  provider: azure
  parameters:
    clientID: {{ .Values.forwarder.secretProvider.msiClientId }}
    keyvaultName: "{{.Values.forwarder.secretProvider.clusterLogsKeyVault}}"
    objects:  |
      array:
        - |
          objectName: "{{.Values.forwarder.secretProvider.clSecret}}"
          objectAlias: "gcscert_cluster.pem"
          objectType: secret
    tenantId: "{{.Values.forwarder.secretProvider.tenantId}}"
{{- end }}