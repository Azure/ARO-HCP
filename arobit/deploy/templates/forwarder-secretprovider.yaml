{{- if .Values.forwarder.secretProvider.enabled }}
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: {{ include "arobit.name" . }}-forwarder-secretprovider
  {{- with .Values.forwarder.secretProvider.labels }}
  labels:
{{ toYaml . | indent 4 }}
  {{- end }}
spec:
  provider: azure
  parameters:
    clientID: {{ .Values.forwarder.secretProvider.msiClientId }}
    keyvaultName: "{{.Values.forwarder.secretProvider.keyVault}}"
    objects:  |
      array:
        - |
          objectName: "{{.Values.forwarder.secretProvider.rpSecret}}"
          objectAlias: "gcscert.pem"
          objectType: secret
      {{- if .Values.forwarder.clusterType | eq "mgmt" }}
        - |
          objectName: "{{.Values.forwarder.secretProvider.clusterLogSecret}}"
          objectAlias: "gcscert_cluster_logs.pem"
          objectType: secret
      {{- end }}
    tenantId: "{{.Values.forwarder.secretProvider.tenantId}}"
{{- end }}