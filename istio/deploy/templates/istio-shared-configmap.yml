{{ range $versionList := .Values.istioVersions }}
{{ range $version := splitList "," $versionList }}
---
kind: ConfigMap
apiVersion: v1
metadata:
  labels:
    istio.io/rev: '{{ $version }}'
  name: istio-shared-configmap-{{ $version }}
  namespace: aks-istio-system
data:
  mesh: |-
    extensionProviders:
    - name: "ext-authz"
      envoyExtAuthzHttp:
        service: "mise/mise.mise.svc.cluster.local"
        port: "8080"
        includeRequestHeadersInCheck: ["x-ext-authz", "mise-inbound-policies-to-filter"]
        pathPrefix: "/v1/EnvoyValidateRequest"
{{ end }}
{{ end }}