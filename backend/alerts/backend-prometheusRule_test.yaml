rule_files:
- backend-prometheusRule.yaml
evaluation_interval: 1m
tests:
# Test: BackendOperationErrorRate above 5%
- interval: 1m
  input_series:
  - series: 'backend_failed_operations_total{type="create"}'
    values: "0 6x10" # 6 failures per minute → 6 / 106 ≈ 5.66%
  - series: 'backend_operations_total{type="create"}'
    values: "0 100x10" # 100 operations per minute from minute 1 to 10
  alert_rule_test:
  - eval_time: 10m # At this point, the condition has held for 10 minutes
    alertname: BackendOperationErrorRate
    exp_alerts:
    - exp_labels:
        severity: info
      exp_annotations:
        description: 'The Backend operation error rate is above 5% for the last hour. Current value: 6%.'
        runbook_url: 'TBD'
        summary: 'High Error Rate on Backend Operations'
# Test: BackendOperationErrorRate below 5%
- interval: 1m
  input_series:
  - series: 'backend_failed_operations_total{type="create"}'
    values: "0 2x10" # 2 failures / 102 total ≈ 1.96%
  - series: 'backend_operations_total{type="create"}'
    values: "0 100x10" # 100 operations per minute from minute 1 to 10
  alert_rule_test:
  - eval_time: 10m # At this point, the condition has held for 10 minutes
    alertname: BackendOperationErrorRate
    exp_alerts: []
# Test: BackendHealthAvailability greater than 300s
- interval: 30s
  input_series:
  - series: "backend_health"
    values: "1x100 0x20 1x20" # 100*30s=3000s up, 20*30s=600s down, 20*30s=600s up
  alert_rule_test:
  - eval_time: 4200s
    alertname: BackendHealthAvailability
    exp_alerts:
    - exp_labels:
        severity: info
      exp_annotations:
        description: 'The Backend has been unavailable for more than 5 minutes in the last hour.'
        runbook_url: 'TBD'
        summary: 'High unavailability on the Backend'
# Test: BackendHealthAvailability less than 300s
- interval: 30s
  input_series:
  - series: "backend_health"
    values: "1x110 0x9 1x1" # 110*30s=3300s up, 9*30s=270s down, 1*30s=30s up
  alert_rule_test:
  - eval_time: 3600s
    alertname: BackendHealthAvailability
    exp_alerts: []
