apiVersion: apps/v1
kind: Deployment
metadata:
    annotations:
        capabilities: Seamless Upgrades
        categories: Integration & Delivery
        certified: "true"
        description: Foundational components for central management of multiple OpenShift Container Platform and Kubernetes clusters
        support: Red Hat
    creationTimestamp: null
    labels:
        control-plane: backplane-operator
    name: multicluster-engine-operator
    namespace: '{{ .Release.Namespace }}'
spec:
    replicas: 2
    selector:
        matchLabels:
            control-plane: backplane-operator
    strategy: {}
    template:
        metadata:
            creationTimestamp: null
            labels:
                control-plane: backplane-operator
                ocm-antiaffinity-selector: backplane-operator
        spec:
            affinity:
                podAntiAffinity:
                    preferredDuringSchedulingIgnoredDuringExecution:
                        - podAffinityTerm:
                            labelSelector:
                                matchExpressions:
                                    - key: ocm-antiaffinity-selector
                                      operator: In
                                      values:
                                        - backplane-operator
                            topologyKey: topology.kubernetes.io/zone
                          weight: 70
                        - podAffinityTerm:
                            labelSelector:
                                matchExpressions:
                                    - key: ocm-antiaffinity-selector
                                      operator: In
                                      values:
                                        - backplane-operator
                            topologyKey: kubernetes.io/hostname
                          weight: 35
            containers:
                - args:
                    - --leader-elect
                  command:
                    - /app/backplane-operator
                  env:
                    - name: POD_NAMESPACE
                      valueFrom:
                        fieldRef:
                            fieldPath: metadata.namespace
                    - name: OPERAND_IMAGE_ADDON_MANAGER
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/addon-manager-rhel9@sha256:c1a34fd7df7ada48d7defe55597699d62c6cc8041c519d05d76ec5c2d6089da5'
                    - name: OPERAND_IMAGE_ASSISTED_IMAGE_SERVICE
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/assisted-image-service-rhel9@sha256:d39208d4fecdf8cd755065f75cee0b89c6b635a9f848af7db070668683ac742d'
                    - name: OPERAND_IMAGE_ASSISTED_INSTALLER
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/assisted-installer-rhel9@sha256:f9d2d5accf046ddca64dac276c442e70e39cd563378478cbc16f6442c0f49353'
                    - name: OPERAND_IMAGE_ASSISTED_INSTALLER_AGENT
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/assisted-installer-agent-rhel9@sha256:6bf89995b13af5b780fc76acfacce92963c128b2240bb5ca93d789849e4e37b3'
                    - name: OPERAND_IMAGE_ASSISTED_INSTALLER_CONTROLLER
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/assisted-installer-controller-rhel9@sha256:e09032c9e9fe882375fc378927ab469dc19230cb29d5e9abf4c44015df0a63e1'
                    - name: OPERAND_IMAGE_ASSISTED_SERVICE_8
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/assisted-service-8-rhel8@sha256:585ebaa5f6f17b5d9098813057b22f627e651a7b729f8babc81f1d19a517ca8c'
                    - name: OPERAND_IMAGE_ASSISTED_SERVICE_9
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/assisted-service-9-rhel9@sha256:370fad1d8082f3a62558f393b3918e3a70ed9d5e12d2d90c2c45eefa626ba270'
                    - name: OPERAND_IMAGE_BACKPLANE_MUST_GATHER
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/must-gather-rhel9@sha256:7c9e9fd9ff26e55dcb988b0631ceabdb383b3367da458ae85e3416c75dfb36d4'
                    - name: OPERAND_IMAGE_CLUSTER_API_PROVIDER_AGENT
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/cluster-api-provider-agent-rhel9@sha256:90907a1d04fb46fdee616d842427a246e03dda9adb04512fe4ee20e3926f2d14'
                    - name: OPERAND_IMAGE_CLUSTER_API_PROVIDER_KUBEVIRT
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/cluster-api-provider-kubevirt-rhel9@sha256:9de4f8ad5b4f3b5748f26a9ece82388dcc46a1d83e4a968df049e9eff6c8d725'
                    - name: OPERAND_IMAGE_CLUSTERCLAIMS_CONTROLLER
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/clusterclaims-controller-rhel9@sha256:da281d6b71e826d4d7863f7737820360375214fd09f21a0c644224eb95022597'
                    - name: OPERAND_IMAGE_CLUSTER_CURATOR_CONTROLLER
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/cluster-curator-controller-rhel9@sha256:25b8d93538eb3f5ef153d920c53cc4fd9116641a9185618dc2dba8447c855e7a'
                    - name: OPERAND_IMAGE_CLUSTER_IMAGE_SET_CONTROLLER
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/cluster-image-set-controller-rhel9@sha256:175cf7058ce1ab2f4698e1c828977254f6483c6f5cbb5fce13060b83458ff81f'
                    - name: OPERAND_IMAGE_CLUSTERLIFECYCLE_STATE_METRICS
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/clusterlifecycle-state-metrics-rhel9@sha256:94424557c5a9914bed5c0712109cd5b5019e656215e6540adf5a40530e2407c6'
                    - name: OPERAND_IMAGE_CLUSTER_PROXY_ADDON
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/cluster-proxy-addon-rhel9@sha256:920beb97b01dd9968ba8a82294676d1b1b2a68bf88c6e33ba939fc3654cf8d67'
                    - name: OPERAND_IMAGE_CLUSTER_PROXY
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/cluster-proxy-rhel9@sha256:b0ff0b045c9d1c67b29f0bb3c504d4c72786f5aab0ab2f2996d17e6129b12c51'
                    - name: OPERAND_IMAGE_CONSOLE_MCE
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/console-mce-rhel9@sha256:5afb5bffd021fc7ab0ee85786aac7c20a554618aaa1ea88f345c408131e79920'
                    - name: OPERAND_IMAGE_DISCOVERY_OPERATOR
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/discovery-rhel9@sha256:bffbdf7ce5c406860a6ec5330a19582c39c13ac3d814ab2c8646badc9e2a5b73'
                    - name: OPERAND_IMAGE_HYPERSHIFT_ADDON_OPERATOR
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/hypershift-addon-rhel9-operator@sha256:20f09bfbbab8e5aac6485b3c067e46b7024dc9b92bcc13e5f07553060a94c9fd'
                    - name: OPERAND_IMAGE_HYPERSHIFT_CLI
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/hypershift-cli-rhel9@sha256:13c6c1865709aff56e07bd674ceb69dfa66c9963a7617366d143d01335d7f647'
                    - name: OPERAND_IMAGE_HYPERSHIFT_OPERATOR
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/hypershift-rhel9-operator@sha256:3946cd2cffb9c2f3baea04e9cb586e427896ed242d4651dbd852f3db315f04ba'
                    - name: OPERAND_IMAGE_IMAGE_BASED_INSTALL_OPERATOR
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/image-based-install-rhel9@sha256:4a81795ec045786b7a69f0bbc257c1a396a00e6d1dd32e0071d62a87d03e5573'
                    - name: OPERAND_IMAGE_KUBE_RBAC_PROXY_MCE
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/kube-rbac-proxy-mce-rhel9@sha256:2aac9b11eeb34945bdf8bed05ed29e86cebbc07c69d85f07c7e0767bef6c9327'
                    - name: OPERAND_IMAGE_MANAGEDCLUSTER_IMPORT_CONTROLLER
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/managedcluster-import-controller-rhel9@sha256:874321f1a1c81364fffb625354262796a3f9e6b0f8151d6ddedc2097606b7ff7'
                    - name: OPERAND_IMAGE_MANAGED_SERVICEACCOUNT
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/managed-serviceaccount-rhel9@sha256:dcff2e75d7246d0ad54849ee12db5b57072e6db973b0f22fde6188a3c0158ece'
                    - name: OPERAND_IMAGE_MULTICLOUD_MANAGER
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/multicloud-manager-rhel9@sha256:761939e1b05ef572e1ab4c06d030adf937468bad8200a12bba287e77ce64fb41'
                    - name: OPERAND_IMAGE_OPENSHIFT_HIVE
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/hive-rhel9@sha256:808725f5bf07430a4840b830f3eb1014077daf6d3a0b4641d8dbb793b3808a2b'
                    - name: OPERAND_IMAGE_PROVIDER_CREDENTIAL_CONTROLLER
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/provider-credential-controller-rhel9@sha256:16eb425b8c3eb673361f493d4d70df90cfc730677a48809eb5b23d1870d512ac'
                    - name: OPERAND_IMAGE_PLACEMENT
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/placement-rhel9@sha256:56e789c1ff8660d2de4701a9c1082a6bf6c5c497f5831031313689bfc736d9f8'
                    - name: OPERAND_IMAGE_REGISTRATION
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/registration-rhel9@sha256:5a1d2c0f73bea6c4519a5d3a8653affe9ae8149086c398d8bac49840ac037126'
                    - name: OPERAND_IMAGE_REGISTRATION_OPERATOR
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/registration-operator-rhel9@sha256:484bc0d10e32b6e84efc7afd0065abd0b8367ec04dde157a68343618cb852d00'
                    - name: OPERAND_IMAGE_WORK
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/work-rhel9@sha256:6233a37d549501a855db04cd5e46be49784f0409afae6cd03dbcf32e3fe4f309'
                    - name: OPERAND_IMAGE_BACKPLANE_OPERATOR
                      value: '{{ .Values.imageRegistry }}/multicluster-engine/backplane-rhel9-operator@sha256:1ac6d64f859d9d8e81dd969ff6e011c3138979969133d354579475a77acf9a29'
                    - name: OPERAND_IMAGE_POSTGRESQL_12
                      value: '{{ .Values.imageRegistry }}/rhel8/postgresql-12@sha256:82d171ab0ce78a0157408662155b53d4f637947a303bfecb684f6132f5f468be'
                    - name: OPERAND_IMAGE_OSE_CLUSTER_API_RHEL9
                      value: '{{ .Values.imageRegistry }}/openshift4/ose-cluster-api-rhel9@sha256:f726a1388eb56168c5d8e77ea1d38e9fb31a9b08f648cf8a5cc86a2e4a23ceb7'
                    - name: OPERAND_IMAGE_OSE_AWS_CLUSTER_API_CONTROLLERS_RHEL9
                      value: '{{ .Values.imageRegistry }}/openshift4/ose-aws-cluster-api-controllers-rhel9@sha256:1be548996ce5f1d4243c0d2ea4c9b523160af44cc65dd1a598d8a4b52f8f7ebf'
                    - name: OPERATOR_VERSION
                      value: 2.8.2
                    - name: OPERATOR_PACKAGE
                      value: multicluster-engine
                  image: '{{ .Values.imageRegistry }}/multicluster-engine/backplane-rhel9-operator@sha256:1ac6d64f859d9d8e81dd969ff6e011c3138979969133d354579475a77acf9a29'
                  livenessProbe:
                    httpGet:
                        path: /healthz
                        port: 8081
                    initialDelaySeconds: 15
                    periodSeconds: 20
                  name: backplane-operator
                  readinessProbe:
                    httpGet:
                        path: /readyz
                        port: 8081
                    initialDelaySeconds: 5
                    periodSeconds: 10
                  resources:
                    limits:
                        cpu: 100m
                        memory: 2Gi
                    requests:
                        cpu: 100m
                        memory: 20Mi
                  securityContext:
                    allowPrivilegeEscalation: false
                    capabilities:
                        drop:
                            - ALL
                    privileged: false
                    readOnlyRootFilesystem: true
                  volumeMounts:
                    - mountPath: /tmp/k8s-webhook-server/serving-certs
                      name: cert
                      readOnly: true
            securityContext:
                runAsNonRoot: true
                seccompProfile:
                    type: RuntimeDefault
            serviceAccountName: multicluster-engine-operator
            terminationGracePeriodSeconds: 10
            volumes:
                - name: cert
                  secret:
                    defaultMode: 420
                    secretName: multicluster-engine-operator-webhook
status: {}
