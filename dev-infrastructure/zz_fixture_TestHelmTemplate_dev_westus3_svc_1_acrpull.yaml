---
# Source: acrpull/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
  name: acrpull
  namespace: 'acrpull'
---
# Source: acrpull/templates/validatingadmissionpolicyparameters.yaml
# This is the configuration file for the MSI-ACRPull Controller. These values will be passed to the helm chart.
# The config map is an easy way to provide an example of the configuration.
# The user must configure:
#   the controllerName and controllerNamespace parameters
#   the token audience: any opaque string, which the reconciler will be restricted to use
apiVersion: v1
kind: ConfigMap
metadata:
  name: "admission-policies-controller-config"
  namespace: 'acrpull'
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
data:
  controllerServiceAccountName: 'acrpull'
  controllerNamespace: 'acrpull'
  tokenAudience: 'api://AzureCRTokenExchange'
---
# Source: acrpull/templates/acrpull.microsoft.com_acrpullbindings.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  name: acrpullbindings.acrpull.microsoft.com
spec:
  group: acrpull.microsoft.com
  names:
    kind: AcrPullBinding
    listKind: AcrPullBindingList
    plural: acrpullbindings
    shortNames:
    - apb
    - apbs
    singular: acrpullbinding
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: FQDN for the ACR.
      jsonPath: .spec.acr.server
      name: Server
      type: string
    - description: Scope for the ACR token.
      jsonPath: .spec.acr.scope
      name: Scope
      priority: 1
      type: string
    - description: ServiceAccount to which the pull credentials are attached.
      jsonPath: .spec.serviceAccountName
      name: Target
      type: string
    - description: Time the token was last refreshed.
      jsonPath: .status.lastTokenRefreshTime
      name: Last Refresh
      priority: 1
      type: date
    - description: Time the current token expires.
      jsonPath: .status.tokenExpirationTime
      name: Expiration
      type: date
    - description: Errors encountered during token generation, if any.
      jsonPath: .status.error
      name: Error
      type: string
    name: v1beta2
    schema:
      openAPIV3Schema:
        description: AcrPullBinding is the Schema for the acrpullbindings API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: AcrPullBindingSpec defines the desired state of AcrPullBinding
            properties:
              acr:
                description: ACR holds specifics of the Azure Container Registry for which credentials are projected.
                properties:
                  cloudConfig:
                    description: AirgappedCloudConfiguration configures a custom cloud to interact with when running air-gapped.
                    properties:
                      entraAuthorityHost:
                        description: EntraAuthorityHost configures a custom Entra host endpoint.
                        minLength: 1
                        type: string
                      resourceManagerAudience:
                        description: ResourceManagerAudience configures the audience for which tokens will be requested from Entra.
                        minLength: 1
                        type: string
                    required:
                    - entraAuthorityHost
                    - resourceManagerAudience
                    type: object
                  environment:
                    default: PublicCloud
                    description: Environment specifies the Azure Cloud environment in which the ACR is deployed.
                    enum:
                    - PublicCloud
                    - USGovernmentCloud
                    - ChinaCloud
                    - AirgappedCloud
                    example: PublicCloud
                    type: string
                  scope:
                    description: |-
                      Scope defines the scope for the access token, e.g. pull/push access for a repository.
                      Note: you need to pin it down to the repository level, there is no wildcard available,
                      however a list of space-delimited scopes is acceptable.
                      See docs for details: https://distribution.github.io/distribution/spec/auth/scope/


                      Examples:
                      repository:my-repository:pull,push
                      repository:my-repository:pull repository:other-repository:push,pull
                    example: repository:my-repository:pull,push
                    minLength: 1
                    type: string
                  server:
                    description: Server is the FQDN for the Azure Container Registry, e.g. example.azurecr.io
                    example: example.azurecr.io
                    type: string
                    x-kubernetes-validations:
                    - message: server must be a fully-qualified domain name
                      rule: isURL('https://' + self) && url('https://' + self).getHostname() == self
                required:
                - environment
                - scope
                - server
                type: object
                x-kubernetes-validations:
                - message: a custom cloud configuration must be present for air-gapped cloud environments
                  rule: 'self.environment == ''ArigappedCloud'' ? has(self.cloudConfig) : !has(self.cloudConfig)'
              auth:
                description: Auth determines how we will authenticate to the Azure Container Registry. Only one method may be provided.
                properties:
                  managedIdentity:
                    description: ManagedIdentity uses Azure Managed Identity to authenticate with Azure.
                    properties:
                      clientID:
                        description: ClientID is the client identifier for the managed identity. Either provide the client ID or the resource ID.
                        example: 1b461305-28be-5271-beda-bd9fd2e24251
                        type: string
                      resourceID:
                        description: ResourceID is the resource identifier for the managed identity. Either provide the client ID or the resource ID.
                        example: /subscriptions/sub-name/resourceGroups/rg-name/providers/Microsoft.ManagedIdentity/userAssignedIdentities/1b461305-28be-5271-beda-bd9fd2e24251
                        type: string
                    type: object
                    x-kubernetes-validations:
                    - message: only client or resource ID can be set
                      rule: '[has(self.clientID), has(self.resourceID)].exists_one(x, x)'
                  workloadIdentity:
                    description: WorkloadIdentity uses Azure Workload Identity to authenticate with Azure.
                    properties:
                      clientID:
                        description: |-
                          ClientID holds an optional client identifier of a federated identity.
                          Specify this identifier if multiple identities are federated with the
                          service account and the identity to use for image pulling is not the
                          default identity stored in the service account's annotations. The
                          client and tenant ID must be specified together.
                        example: 1b461305-28be-5271-beda-bd9fd2e24251
                        type: string
                      serviceAccountRef:
                        description: |-
                          ServiceAccountName specifies the name of the service account
                          that should be used when authenticating with WorkloadIdentity.
                        type: string
                      tenantID:
                        description: |-
                          TenantID holds an optional tenant identifier of a federated identity.
                          Specify this identifier if multiple identities are federated with the
                          service account and the identity to use for image pulling is not the
                          default identity stored in the service account's annotations. The
                          client and tenant ID must be specified together.
                        example: 72f988bf-86f1-41af-91ab-2d7cd011db47
                        type: string
                    type: object
                    x-kubernetes-validations:
                    - message: custom client and tenant identifiers must be provided together, if at all
                      rule: (has(self.clientID) && has(self.tenantID)) || (!has(self.clientID) && !has(self.tenantID))
                type: object
                x-kubernetes-validations:
                - message: only one authentication type can be set
                  rule: '[has(self.managedIdentity), has(self.workloadIdentity)].exists_one(x, x)'
              serviceAccountName:
                description: The name of the service account to associate the image pull secret with.
                type: string
            type: object
          status:
            description: AcrPullBindingStatus defines the observed state of AcrPullBinding
            properties:
              error:
                description: Error message if there was an error updating the token.
                type: string
              lastTokenRefreshTime:
                description: Information when was the last time the ACR token was refreshed.
                format: date-time
                type: string
              tokenExpirationTime:
                description: The expiration date of the current ACR token.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
# Source: acrpull/templates/msi-acrpull.microsoft.com_acrpullbindings.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  name: acrpullbindings.msi-acrpull.microsoft.com
spec:
  group: msi-acrpull.microsoft.com
  names:
    kind: AcrPullBinding
    listKind: AcrPullBindingList
    plural: acrpullbindings
    singular: acrpullbinding
  scope: Namespaced
  versions:
  - name: v1beta1
    schema:
      openAPIV3Schema:
        description: AcrPullBinding is the Schema for the acrpullbindings API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: AcrPullBindingSpec defines the desired state of AcrPullBinding
            properties:
              acrServer:
                description: The full server name for the ACR. For example, test.azurecr.io
                minLength: 0
                type: string
              managedIdentityClientID:
                description: The Managed Identity client ID that is used to authenticate with ACR (specify one of ClientID or ResourceID)
                type: string
              managedIdentityResourceID:
                description: The Managed Identity resource ID that is used to authenticate with ACR (if ClientID is specified, this is ignored)
                type: string
              scope:
                description: |-
                  The registry scope which the pull token should have. For example, repository:my-repository:pull,push
                  See docs for details: https://distribution.github.io/distribution/spec/auth/scope/
                type: string
              serviceAccountName:
                description: |-
                  The Service Account to associate the image pull secret with. If this is not specified, the default Service Account
                  of the namespace will be used.
                type: string
            required:
            - acrServer
            type: object
          status:
            description: AcrPullBindingStatus defines the observed state of AcrPullBinding
            properties:
              error:
                description: Error message if there was an error updating the token.
                type: string
              lastTokenRefreshTime:
                description: Information when was the last time the ACR token was refreshed.
                format: date-time
                type: string
              tokenExpirationTime:
                description: The expiration date of the current ACR token.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
# Source: acrpull/templates/controller_role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: acrpull-controller
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - '*'
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  verbs:
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - serviceaccounts/token
  verbs:
  - create
- apiGroups:
  - acrpull.microsoft.com
  resources:
  - acrpullbindings
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - acrpull.microsoft.com
  resources:
  - acrpullbindings/finalizers
  verbs:
  - update
- apiGroups:
  - acrpull.microsoft.com
  resources:
  - acrpullbindings/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - msi-acrpull.microsoft.com
  resources:
  - acrpullbindings
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - msi-acrpull.microsoft.com
  resources:
  - acrpullbindings/finalizers
  verbs:
  - update
- apiGroups:
  - msi-acrpull.microsoft.com
  resources:
  - acrpullbindings/status
  verbs:
  - get
  - patch
  - update
---
# Source: acrpull/templates/controller_role_binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
  name: acrpull-controller-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: acrpull-controller
subjects:
- kind: ServiceAccount
  name: acrpull
  namespace: 'acrpull'
---
# Source: acrpull/templates/leader_election_role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
  name: acrpull-controller-leader-election
  namespace: 'acrpull'
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - patch
---
# Source: acrpull/templates/leader_election_role_binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
  name: acrpull-controller-leader-election-binding
  namespace: 'acrpull'
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: acrpull-controller-leader-election
subjects:
- kind: ServiceAccount
  name: acrpull
  namespace: 'acrpull'
---
# Source: acrpull/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: acrpull
  namespace: 'acrpull'
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: acrpull
  replicas: 2
  template:
    metadata:
      labels:
        app.kubernetes.io/name: acrpull
    spec:
      securityContext:
        runAsNonRoot: true
      containers:
      - command:
        - /manager
        args:
        - "--health-probe-bind-address=:8081"
        - "--metrics-bind-address=127.0.0.1:8080"
        - "--leader-elect"
        - "--ttl-rotation-fraction=0.5"
        image: "mcr.microsoft.com/aks/msi-acrpull@sha256:1234567890"
        name: acrpull-controller
        ports:
        - containerPort: 8080
          protocol: TCP
          name: metrics
        securityContext:
          runAsNonRoot: true
          seccompProfile:
            type: RuntimeDefault
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - "ALL"
          readOnlyRootFilesystem: true
          runAsUser: 1000
          runAsGroup: 3000
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8081
          initialDelaySeconds: 15
          periodSeconds: 20
        readinessProbe:
          httpGet:
            path: /readyz
            port: 8081
          initialDelaySeconds: 5
          periodSeconds: 10
        resources:
          limits:
            cpu: 100m
            memory: 1Gi
          requests:
            cpu: 100m
            memory: 20Mi
      serviceAccountName: acrpull
      terminationGracePeriodSeconds: 10
---
# Source: acrpull/templates/podmonitor.yaml
apiVersion: monitoring.coreos.com/v1
kind: PodMonitor
metadata:
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
  name: acrpull
  namespace: 'acrpull'
spec:
  podMetricsEndpoints:
  - port: metrics
    path: /metrics
  selector:
    matchLabels:
      app.kubernetes.io/name: acrpull
---
# Source: acrpull/templates/validatingadmissionpolicies.yaml
# This policy validates the configuration of the tokens that are created by the msi-acrpull controller.
# It requires the parameters controllerServiceAccountName, controllerNamespace, token expiration, and token audiences
# to be set in the ConfigMap admission-policies-controller-config.
# The user must configure:
#   the token audiences
#   the controllerServiceAccountName and controllerNamespace parameters
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingAdmissionPolicy
metadata:
  name: "controller-token-request-policy"
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
spec:
  failurePolicy: Fail
  paramKind:
    apiVersion: v1
    kind: ConfigMap
  matchConditions:
  - name: 'userIsController'
    expression: "request.userInfo.username == 'system:serviceaccount:'+params.data.controllerNamespace+':'+params.data.controllerServiceAccountName"
  matchConstraints:
    matchPolicy: Equivalent
    namespaceSelector: {}
    objectSelector: {}
    resourceRules:
    - apiGroups: [""]
      apiVersions: ["v1"]
      operations: ["CREATE"]
      resources: ["serviceaccounts/token"]
      scope: '*'
  variables:
  - name: requestHasOnlyOneAudience
    expression: "object.spec.audiences.size() == 1"
  - name: hasCorrectAudience
    expression: "object.spec.audiences.exists(w, w == params.data.tokenAudience)"
  validations:
  - expression: "variables.hasCorrectAudience == true && variables.requestHasOnlyOneAudience == true" # if the expression evaluates to false, the validation check is enforced according to the failurePolicy
    messageExpression: "string(params.data.controllerServiceAccountName)  + ' has failed to ' +  string(request.operation) + ' ' + string(request.name) + ' token in the ' + string(request.namespace) + ' namespace. Check the configuration.'"
    reason: "Forbidden"
---
# Source: acrpull/templates/validatingadmissionpolicies.yaml
# This policy is used to restrict the types of secrets that the controller can create or update. We only allow the controller
# to create dockerconfigjson secret types, as allowing other types would allow privilege escalations and unwanted behavior.
# (For example, service account token secret types get auto-populated with tokens.)
# We furthermore restrict the controller to creating and updating secrets with the label we use for limiting our informers.
# It requires the parameter controllerName, controllerNamespace and the list of secret types to allow to be set in the
# ConfigMap admission-policies-controller-config.
# The user must configure:
#   the controllerServiceAccountName and controllerNamespace parameters
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingAdmissionPolicy
metadata:
  name: "controller-secret-mutation-policy"
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
spec:
  failurePolicy: Fail
  paramKind:
    apiVersion: v1
    kind: ConfigMap
  matchConditions:
  - name: 'userIsController'
    expression: "request.userInfo.username == 'system:serviceaccount:'+params.data.controllerNamespace+':'+params.data.controllerServiceAccountName"
  matchConstraints:
    matchPolicy: Equivalent
    namespaceSelector: {}
    objectSelector: {}
    resourceRules:
    - apiGroups: [""]
      apiVersions: ["v1"]
      operations: ["CREATE", "UPDATE"]
      resources: ["secrets"]
      scope: '*'
  variables:
  - name: hasOwner
    expression: "has(object.metadata.ownerReferences) && (size(object.metadata.ownerReferences) == 1 && object.metadata.ownerReferences.all(o, o.kind == 'AcrPullBinding' && (o.apiVersion.startsWith('msi-acrpull.microsoft.com/') || o.apiVersion.startsWith('acrpull.microsoft.com/'))))"
  - name: matchesPreviousOwner
    expression: "has(oldObject.metadata) ? oldObject.metadata.ownerReferences == object.metadata.ownerReferences : true"
  - name: hasSecretType
    expression: "object.type == 'kubernetes.io/dockerconfigjson'"
  - name: matchesPreviousSecretType
    expression: "has(oldObject.metadata) ? oldObject.type == object.type : true"
  - name: hasLabel
    expression: "object.metadata.name.matches('-msi-acrpull-secret$') ? true : (has(object.metadata.labels) && ('acr.microsoft.com/binding' in object.metadata.?labels.orValue({})))"
  - name: matchesPreviousLabel
    expression: "object.metadata.name.matches('-msi-acrpull-secret$') ? true : (has(oldObject.metadata) ? oldObject.metadata.labels == object.metadata.labels : true)"
  validations:
  - expression: "variables.hasOwner == true && variables.matchesPreviousOwner == true && variables.hasSecretType == true && variables.matchesPreviousSecretType == true && variables.hasLabel == true && variables.matchesPreviousLabel == true"
    messageExpression: "string(params.data.controllerServiceAccountName)  + ' has failed to ' +  string(request.operation) + ' secret with ' + string(object.type) + ' type ' + 'in the ' + string(request.namespace) + ' namespace. The controller can only create or update secrets that it owns, with the correct type and having the correct label.' + string(variables.hasOwner == true) + string(variables.matchesPreviousOwner == true) + string(variables.hasSecretType == true) + string(variables.matchesPreviousSecretType == true) + string(variables.hasLabel == true) + string(variables.matchesPreviousLabel == true )"
    reason: "Forbidden"
---
# Source: acrpull/templates/validatingadmissionpolicies.yaml
# This policy will deny updates to serviceAccounts that do something other than changing the list of managed pull secrets.
# It requires the parameter controllerServiceAccountName and controllerNamespace to be set in the
# ConfigMap admission-policies-controller-config.
# The user must configure:
#   the controllerServiceAccountName and controllerNamespace parameters
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingAdmissionPolicy
metadata:
  name: "controller-service-account-mutation-policy"
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
spec:
  failurePolicy: Fail
  paramKind:
    apiVersion: v1
    kind: ConfigMap
  matchConditions:
  - name: 'userIsController'
    expression: "request.userInfo.username == 'system:serviceaccount:'+params.data.controllerNamespace+':'+params.data.controllerServiceAccountName"
  matchConstraints:
    matchPolicy: Equivalent
    namespaceSelector: {}
    objectSelector: {}
    resourceRules:
    - apiGroups: [""]
      apiVersions: ["v1"]
      operations: ["UPDATE"]
      resources: ["serviceaccounts"]
      scope: '*'
  variables:
  - name: secretsUnchanged
    expression: "oldObject.?secrets == object.?secrets"
  - name: automountUnchanged
    expression: "oldObject.?automountServiceAccountToken == object.?automountServiceAccountToken"
  - name: previousPullSecretNames
    expression: "oldObject.?imagePullSecrets.orValue([]).map(s, s.name)"
  - name: pullSecretNames
    expression: "object.?imagePullSecrets.orValue([]).map(s, s.name)"
  - name: addedPullSecrets
    expression: "variables.pullSecretNames.filter(s, !(s in variables.previousPullSecretNames))"
  - name: removedPullSecrets
    expression: "variables.previousPullSecretNames.filter(s, !(s in variables.pullSecretNames))"
  - name: onlyCorrectPullSecretsAdded
    expression: "variables.addedPullSecrets.all(s, s.matches('^acr-pull-') || s.matches('-msi-acrpull-secret$'))"
  - name: onlyCorrectPullSecretsRemoved
    expression: "variables.removedPullSecrets.all(s, s.matches('^acr-pull-') || s.matches('-msi-acrpull-secret$'))"
  validations:
  - expression: "variables.secretsUnchanged == true && variables.automountUnchanged == true && variables.onlyCorrectPullSecretsAdded == true && variables.onlyCorrectPullSecretsRemoved == true"
    messageExpression: "string(params.data.controllerServiceAccountName) + ' has failed to ' + string(request.operation) + ' service account ' + string(request.name) + ' in the ' + string(request.namespace) + ' namespace. The controller may only update service accounts to add or remove pull secrets that the controller manages.' + string(variables.automountUnchanged == true) + string(variables.automountUnchanged == true) + string(variables.onlyCorrectPullSecretsAdded == true) + string(variables.onlyCorrectPullSecretsRemoved == true)"
    reason: "Forbidden"
---
# Source: acrpull/templates/validatingadmissionpolicybindings.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingAdmissionPolicyBinding
metadata:
  name: "controller-token-request-policy-binding"
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
spec:
  policyName: "controller-token-request-policy"
  validationActions: [Deny]
  paramRef:
    name: "admission-policies-controller-config"
    namespace: 'acrpull'
    parameterNotFoundAction: "Allow"
---
# Source: acrpull/templates/validatingadmissionpolicybindings.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingAdmissionPolicyBinding
metadata:
  name: "controller-secret-mutation-policy-binding"
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
spec:
  policyName: "controller-secret-mutation-policy"
  validationActions: [Deny]
  paramRef:
    name: "admission-policies-controller-config"
    namespace: 'acrpull'
    parameterNotFoundAction: "Allow"
---
# Source: acrpull/templates/validatingadmissionpolicybindings.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingAdmissionPolicyBinding
metadata:
  name: "controller-service-account-mutation-policy-binding"
  labels:
    app.kubernetes.io/name: acrpull
    app.kubernetes.io/managed-by: Helm
spec:
  policyName: "controller-service-account-mutation-policy"
  validationActions: [Deny]
  paramRef:
    name: "admission-policies-controller-config"
    namespace: 'acrpull'
    parameterNotFoundAction: "Allow"

