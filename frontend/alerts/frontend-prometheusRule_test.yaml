rule_files:
- frontend-prometheusRule.yaml
evaluation_interval: 1m
tests:
# Test: FrontendLatency 95th percentile does not exceed 5 seconds
# Test: FrontendLatency Less than 5% of requests exceed 5 seconds
- interval: 1m
  input_series:
  - series: 'frontend_http_requests_duration_seconds_bucket{le="0.1"}'
    values: '0+60x10'
  - series: 'frontend_http_requests_duration_seconds_bucket{le="0.5"}'
    values: '0+60x20'
  - series: 'frontend_http_requests_duration_seconds_bucket{le="1"}'
    values: '0+60x30'
  - series: 'frontend_http_requests_duration_seconds_bucket{le="5"}'
    values: '0+60x190'
  - series: 'frontend_http_requests_duration_seconds_bucket{le="+Inf"}'
    values: '0+60x200'
  alert_rule_test:
  - eval_time: 60m
    alertname: FrontendLatency
    exp_alerts: []
# Test: FrontendClusterServiceErrorRate above 5%
- interval: 1m
  input_series:
  - series: 'frontend_clusters_service_client_request_count{code="500"}'
    values: "0 6x10" # 6 per minute → 6 / 106 ≈ 5.66%
  - series: 'frontend_clusters_service_client_request_count{code="200"}'
    values: "0 100x10" # 100 per minute from minute 1 to 10
  alert_rule_test:
  - eval_time: 10m # At this point, the condition has held for 10 minutes
    alertname: FrontendClusterServiceErrorRate
    exp_alerts:
    - exp_labels:
        severity: info
      exp_annotations:
        description: 'The Frontend Cluster Service 5xx error rate is above 5% for the last hour. Current value: 5.66%.'
        runbook_url: 'TBD'
        summary: 'High 4xx|5xx Error Rate on Frontend Cluster Service'
# Test: FrontendClusterServiceErrorRate below 5%
- interval: 1m
  input_series:
  - series: 'frontend_clusters_service_client_request_count{code="500"}'
    values: "0 2x10" # 2 / 102 ≈ 1.96%
  - series: 'frontend_clusters_service_client_request_count{code="200"}'
    values: "0 100x10" # 100 per minute from minute 1 to 10
  alert_rule_test:
  - eval_time: 10m # At this point, the condition has held for 10 minutes
    alertname: FrontendClusterServiceErrorRate
    exp_alerts: []
