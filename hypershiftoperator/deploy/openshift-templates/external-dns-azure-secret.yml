---
apiVersion: v1
kind: Template
metadata:
  name: exernal-dns
parameters:

  - name: AZURE_TENANT_ID
    required: true

  - name: AZURE_SUBSCRIPTION_ID
    required: true

  - name: EXTERNAL_DNS_OPERATOR_MI_CLIENT_ID
    required: true

  - name: ZONE_RESOURCE_GROUP
    required: true

objects:
- apiVersion: v1
  kind: Secret
  metadata:
    name: external-dns-azure
  type: Opaque
  stringData:
    credentials: |
      {
        "tenantId": "${AZURE_TENANT_ID}",
        "subscriptionId": "${AZURE_SUBSCRIPTION_ID}",
        "resourceGroup": "${ZONE_RESOURCE_GROUP}",
        "useWorkloadIdentityExtension": true,
        "userAssignedIdentityID": "${EXTERNAL_DNS_OPERATOR_MI_CLIENT_ID}"
      }
