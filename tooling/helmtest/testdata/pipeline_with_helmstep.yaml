$schema: "pipeline.schema.v1"
serviceGroup: Microsoft.Test.Infra
rolloutName: Test  Rollout
resourceGroups:
- name: global
  resourceGroup: rg
  subscription: foo-bar
  steps:
  - name: output
    action: ARM
    template: templates/output-global.bicep
    parameters: configurations/output-global.tmpl.bicepparam
    deploymentLevel: ResourceGroup
    outputOnly: true
- name: kusto
  resourceGroup: rg
  subscription: foo-bar
  steps:
  - name: kusto-lookup
    action: ARM
    template: templates/kusto-lookup.bicep
    parameters: configurations/kusto-lookup.bicepparam
    deploymentLevel: ResourceGroup
    outputOnly: true
- name: test
  resourceGroup: rg
  subscription: foo-bar
  steps:
  - name: test
    aksCluster: foo-bar
    action: Helm
    releaseName: testing
    releaseNamespace: namespace
    namespaceFiles:
    - foo-bar.yaml
    chartDir: ./deploy
    valuesFile: ./values-testing-foo.yaml
    identityFrom:
      resourceGroup: global
      step: output
      name: globalMSIId
    kustoEndpoint:
      resourceGroup: kusto
      step: kusto-lookup
      name: kustoUri
    kustoDatabase: testDatabase
    kustoTable: testTable
