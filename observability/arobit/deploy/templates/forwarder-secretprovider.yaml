---
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: arobit-secretprovider
  namespace: '{{ .Release.Namespace }}'
spec:
  provider: azure
  parameters:
    clientID: '{{ .Values.forwarder.msiClientId }}'
    cloudName: '{{ .Values.forwarder.azureCloudEnvironmentName }}'
    keyvaultName: "{{.Values.forwarder.secretProvider.keyVault}}"
    objects: |
      array:
        - |
          objectName: "{{.Values.forwarder.mdsd.geneva.rpSecretName}}"
          objectAlias: "gcscert.pem"
          objectType: secret
    tenantId: "{{.Values.forwarder.tenantId}}"
    usePodIdentity: "false"
{{- if .Values.forwarder.clusterType | eq "mgmt" }}
---
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: arobit-secretprovider-clusterlogs
  namespace: '{{ .Release.Namespace }}'
spec:
  provider: azure
  parameters:
    clientID: '{{ .Values.forwarder.msiClientId }}'
    cloudName: '{{ .Values.forwarder.azureCloudEnvironmentName }}'
    keyvaultName: "{{.Values.forwarder.secretProvider.keyVault}}"
    objects: |
      array:
        - |
          objectName: "{{.Values.forwarder.mdsd.geneva.clusterLogsSecretName}}"
          objectAlias: "gcscert.pem"
          objectType: secret
    tenantId: "{{.Values.forwarder.tenantId}}"
    usePodIdentity: "false"
{{- end }}