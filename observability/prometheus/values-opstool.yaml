kube-prometheus-stack:
  fullnameOverride: "prometheus"
  crds:
    enabled: true
  global:
    rbac:
      create: true
  alertmanager:
    enabled: false
  grafana:
    enabled: false
  # Azure Managed Prometheus will scrape or expose these metrics
  coreDns:
    enabled: false
  kubeDns:
    enabled: false
  nodeExporter:
    enabled: false
  kubeEtcd:
    enabled: false
  kubeScheduler:
    enabled: false
  kubeControllerManager:
    enabled: false
  kubeProxy:
    enabled: false
  kubelet:
    enabled: false
  kubeApiServer:
    enabled: false
  kubeStateMetrics:
    enabled: true
  prometheus:
    enabled: false # Prometheus is deployed using templates/prometheus.yaml
  prometheusOperator:
    enabled: true
    fullnameOverride: ""
    admissionWebhooks:
      enabled: true
      patch:
        tolerations:
        - key: "infra"
          operator: "Equal"
          value: "true"
          effect: "NoSchedule"
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
              - matchExpressions:
                - key: aro-hcp.azure.com/role
                  operator: In
                  values:
                  - infra
    tolerations:
    - key: "infra"
      operator: "Equal"
      value: "true"
      effect: "NoSchedule"
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: aro-hcp.azure.com/role
              operator: In
              values:
              - infra
    image:
      registry: "{{ .opstool.prometheus.prometheusOperator.image.registry }}"
      repository: "{{ .opstool.prometheus.prometheusOperator.image.repository }}"
      sha: "{{ .opstool.prometheus.prometheusOperator.image.sha }}"
    prometheusConfigReloader:
      image:
        registry: "{{ .opstool.prometheus.prometheusConfigReloader.image.registry }}"
        repository: "{{ .opstool.prometheus.prometheusConfigReloader.image.repository }}"
        sha: "{{ .opstool.prometheus.prometheusConfigReloader.image.sha }}"
  cleanPrometheusOperatorObjectNames: true
  kube-state-metrics:
    image:
      registry: "{{ .opstool.prometheus.kubeStateMetrics.image.registry }}"
      repository: "{{ .opstool.prometheus.kubeStateMetrics.image.repository }}"
      sha: "{{ .opstool.prometheus.kubeStateMetrics.image.digest }}"
    tolerations:
    - key: "infra"
      operator: "Equal"
      value: "true"
      effect: "NoSchedule"
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: aro-hcp.azure.com/role
              operator: In
              values:
              - infra
# config for the files in templates/
prometheusSpec:
  image:
    registry: "{{ .opstool.prometheus.prometheusSpec.image.registry }}"
    repository: "{{ .opstool.prometheus.prometheusSpec.image.repository }}"
    sha: "{{ .opstool.prometheus.prometheusSpec.image.sha }}"
  version: ""
  externalLabels:
    cluster: "{{ .opstool.aks.name }}"
  remoteWriteUrl: "__dcrRemoteWriteUrl__"
  hcpRemoteWriteUrl: "__dcrRemoteWriteUrl__"
  zoneCount: 1
  maximumStartupDurationSeconds: 360
  retention: 6h
  retentionSize: 10GiB
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 1
      memory: 2Gi
prometheus:
  prometheusSpec:
    shards: 1
    replicas: 1
  serviceAccount:
    managedIdentity: "__prometheusUAMIClientId__"
environment: "opstool"
remoteWrite:
  url: "__dcrRemoteWriteUrl__"
  clientId: "__prometheusUAMIClientId__"
