apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: msi-credential-refresher-prometheus-rule
  namespace: monitoring
spec:
  groups:
  - name: msi-credential-refresher
    interval: 1m
    rules:
    - alert: ClusterCredentialExpiringSoon
      expr: increase(credential_refresher_days_until_msi_credential_expiration_bucket{le="14"}[30m]) > 0
      for: 5m
      labels:
        severity: critical
      annotations:
        description: 'Cluster credential for cluster {{ $labels.cluster }} is expiring in less than 30 days.'
        summary: 'Cluster credential expiring in less than 30 days'
        runbook_url: 'https://eng.ms/docs/cloud-ai-platform/azure-core/azure-cloud-native-and-management-platform/control-plane-bburns/azure-red-hat-openshift/azure-redhat-openshift-team-doc/doc/tsgs/credential-refresher-expiring-cert'
        correlationId: 'ClusterCredentialExpiringSoon/{{ $labels.cluster }}'
