---
  name: ARO HCP Services Continous Integration
  env:
    DEPLOY_ENV: dev
    AZURE_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
    AZURE_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}
    AZURE_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
    PRINCIPAL_ID: ${{ secrets.GHA_PRINCIPAL_ID }}
  on:
    pull_request:
      branches:
        - main
      paths:
        - '.github/workflows/services-ci.yml'
        - '.github/workflows/reusable/services-ci.yml'
        - 'config/config.yaml'
        - 'api/**'
        - 'frontend/**'
        - 'backend/**'
        - 'internal/**'
        - 'pko/**'
        - 'image-sync/**/'
        - 'tooling/image-sync/**'
        - 'tooling/templatize/**'
        - 'templatize.sh'
      types:
        - opened
        - synchronize
        - reopened
    workflow_call:
      inputs:
        push:
          description: 'Push to the registry'
          required: true
          type: boolean
      secrets:
        AZURE_CLIENT_ID:
          description: 'Azure Client ID'
          required: true
        AZURE_TENANT_ID:
          description: 'Azure Tenant ID'
          required: true
        AZURE_SUBSCRIPTION_ID:
          description: 'Azure Subscription ID'
          required: true

  jobs:

    build-and-test:
      name: 'Build and test service images'
      permissions:
        id-token: 'write'
        contents: 'read'
      secrets: inherit
      uses: ./.github/workflows/reusable/services-ci.yml
      with:
        push: false
