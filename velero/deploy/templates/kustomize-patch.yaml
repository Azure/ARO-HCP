apiVersion: v1
kind: ConfigMap
metadata:
  name: velero-kustomize-patch
  namespace: '{{ .Release.Namespace }}'
  annotations:
    "helm.sh/hook": post-install,post-upgrade
    "helm.sh/hook-weight": "0"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
data:
  kustomization.yaml: |
    resources:
    - velero.yaml
    patches:
    - path: scheduling-patch.yaml
  scheduling-patch.yaml: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: velero
      namespace: {{ .Release.Namespace }}
    spec:
      template:
        spec:
          nodeSelector:
            aro-hcp.azure.com/role: infra
          tolerations:
          - key: "infra"
            operator: "Equal"
            value: "true"
            effect: "NoSchedule"
